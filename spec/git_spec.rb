module Gitpaint
  context 'git operations' do
    REPO = 'tmp/somerepo'

    before :all do
      @start_dir = Dir.pwd
      @g = Git.init REPO
    end

    after :all do
      Dir.chdir @start_dir
      FileUtils.rm_r REPO
    end

    it 'creates commits', :vcr do
      data = [[1, 0, 1], [], [0, 1, 0]]
      Timecop.freeze '2018-06-15' do
        Gitpaint.paint data, REPO, nuke: false, push: false
        log = @g.log
        expect(log.map { |l| l.author.date.iso8601 }).to eq [
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00'
        ]

        expect(log.map { |l| l.committer.date.iso8601 }).to eq [
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-25T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-20T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00',
          '2017-06-11T12:00:00+01:00'
        ]
      end
    end
  end
end
